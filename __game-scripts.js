var PathFinder=pc.createScript("pathFinder");PathFinder.prototype.initialize=function(){this.app.on("pathFinder:useGraph",this.useGraph,this)},PathFinder.prototype.update=function(t){},PathFinder.prototype.useGraph=function(t){this.graph=t,this.pathFinder=ngraphPath.aGreedy(this.graph,{distance:(t,i)=>t.data.position.distance(i.data.position),heuristic:(t,i)=>t.data.position.distance(i.data.position)}),this.app.fire("MonstaAi:getPathFinder",this.pathFinder)};var FlyCamera=pc.createScript("flyCamera");FlyCamera.attributes.add("speed",{type:"number",default:10}),FlyCamera.attributes.add("fastSpeed",{type:"number",default:20}),FlyCamera.attributes.add("mode",{type:"number",default:0,enum:[{Lock:0},{Drag:1}]}),FlyCamera.prototype.initialize=function(){var e=this.entity.getLocalEulerAngles();this.ex=e.x,this.ey=e.y,this.moved=!1,this.lmbDown=!1,this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)},FlyCamera.prototype.update=function(e){this.entity.setLocalEulerAngles(this.ex,this.ey,0);var t=this.app,s=this.speed;t.keyboard.isPressed(pc.KEY_SHIFT)&&(s=this.fastSpeed),t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W)?this.entity.translateLocal(0,0,-s*e):(t.keyboard.isPressed(pc.KEY_DOWN)||t.keyboard.isPressed(pc.KEY_S))&&this.entity.translateLocal(0,0,s*e),t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A)?this.entity.translateLocal(-s*e,0,0):(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D))&&this.entity.translateLocal(s*e,0,0)},FlyCamera.prototype.onMouseMove=function(e){if(this.mode){if(!this.lmbDown)return}else if(!pc.Mouse.isPointerLocked())return;this.moved?(this.ex-=e.dy/5,this.ex=pc.math.clamp(this.ex,-90,90),this.ey-=e.dx/5):this.moved=!0},FlyCamera.prototype.onMouseDown=function(e){0===e.button&&(this.lmbDown=!0,this.mode||pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},FlyCamera.prototype.onMouseUp=function(e){0===e.button&&(this.lmbDown=!1)};function PixelateEffect(e){pc.PostEffect.call(this,e),this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:[e.webgl2?"#version 300 es\n\n"+pc.shaderChunks.gles3VS:"","attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:[e.webgl2?"#version 300 es\n\n"+pc.shaderChunks.gles3PS:"","precision "+e.precision+" float;",pc.shaderChunks.screenDepthPS,"","varying vec2 vUv0;","","uniform vec2 uResolution;","uniform sampler2D uColorBuffer;","uniform float uAmount;","","void main() {","    highp vec2 uv = vUv0; // variable_vertex.xy; // interpolated at pixel's center","","   vec2 pixelateDxy = uAmount / uResolution;","   vec2 pixelateCoord = pixelateDxy * floor( uv / pixelateDxy );","   gl_FragColor = texture2D(uColorBuffer, pixelateCoord);","}"].join("\n")}),this.amount=10}PixelateEffect.prototype=Object.create(pc.PostEffect.prototype),PixelateEffect.prototype.constructor=PixelateEffect,Object.assign(PixelateEffect.prototype,{render:function(e,t,i){var o=this.device,a=o.scope;a.resolve("uResolution").setValue([o.width,o.height]),a.resolve("uAmount").setValue(this.amount),a.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}});var Pixelate=pc.createScript("pixelate");Pixelate.attributes.add("amount",{type:"number",default:12,min:1,max:64,title:"Amount",description:"The size of each pixel."}),Pixelate.prototype.initialize=function(){this.effect=new PixelateEffect(this.app.graphicsDevice),this.effect.amount=this.amount,this.on("attr",(function(e,t){this.effect[e]=t}),this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function FxaaEffect(e){pc.PostEffect.call(this,e);var o={aPosition:pc.SEMANTIC_POSITION},t=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:t,fshader:a}),this.resolution=new Float32Array(2)}FxaaEffect.prototype=Object.create(pc.PostEffect.prototype),FxaaEffect.prototype.constructor=FxaaEffect,Object.assign(FxaaEffect.prototype,{render:function(e,o,t){var a=this.device,r=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,r.resolve("uResolution").setValue(this.resolution),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,t)}});var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function VerticalTiltShiftEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uV;","uniform float uR;","","varying vec2 vUv0;","","void main() {","    vec4 sum = vec4( 0.0 );","    float vv = uV * abs( uR - vUv0.y );","","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 4.0 * vv ) ) * 0.051;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 3.0 * vv ) ) * 0.0918;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 2.0 * vv ) ) * 0.12245;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 1.0 * vv ) ) * 0.1531;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 1.0 * vv ) ) * 0.1531;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 2.0 * vv ) ) * 0.12245;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 3.0 * vv ) ) * 0.0918;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 4.0 * vv ) ) * 0.051;","","    gl_FragColor = sum;","}"].join("\n")}),this.focus=.35}VerticalTiltShiftEffect.prototype=Object.create(pc.PostEffect.prototype),VerticalTiltShiftEffect.prototype.constructor=VerticalTiltShiftEffect,Object.assign(VerticalTiltShiftEffect.prototype,{render:function(t,e,i){var f=this.device,v=f.scope;v.resolve("uV").setValue(1/t.height),v.resolve("uR").setValue(this.focus),v.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(f,e,this.vertexBuffer,this.shader,i)}});var VerticalTiltShift=pc.createScript("verticalTiltShift");VerticalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,title:"Focus"}),VerticalTiltShift.prototype.initialize=function(){this.effect=new VerticalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",(function(t){this.effect.focus=t}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var CharacterController=pc.createScript("characterController");CharacterController.attributes.add("speed",{type:"number",default:5}),CharacterController.attributes.add("jumpImpulse",{type:"number",default:400}),CharacterController.prototype.initialize=function(){this.groundCheckRay=new pc.Vec3(0,-1.2,0),this.rayEnd=new pc.Vec3,this.groundNormal=new pc.Vec3,this.onGround=!0,this.jumping=!1},CharacterController.prototype.move=function(t){if(this.onGround&&!this.jumping){var r=new pc.Vec3,e=t.length();e>0&&(r.cross(this.groundNormal,t).cross(r,this.groundNormal),r.normalize().scale(e*this.speed)),this.entity.rigidbody.linearVelocity=r}},CharacterController.prototype.jump=function(){this.onGround&&!this.jumping&&(this.entity.rigidbody.applyImpulse(0,this.jumpImpulse,0),this.onGround=!1,this.jumping=!0,setTimeout(function(){this.jumping=!1}.bind(this),500))},CharacterController.prototype.update=function(t){var r=this.entity.getPosition();this.rayEnd.add2(r,this.groundCheckRay);var e=this.app.systems.rigidbody.raycastFirst(r,this.rayEnd);this.onGround=!!e,e&&this.groundNormal.copy(e.normal)};var AddSingleCollisionMesh=pc.createScript("addSingleCollisionMesh");AddSingleCollisionMesh.attributes.add("modelContainerAsset",{type:"asset",assetType:"container"}),AddSingleCollisionMesh.prototype.initialize=function(){this.entity.collision&&"mesh"===this.entity.collision.type&&(this.entity.collision.asset=this.modelContainerAsset.resource.model)};var FirstPersonView=pc.createScript("firstPersonView");FirstPersonView.attributes.add("camera",{title:"Camera",description:"The camera controlled by this first person view. It should be a child of the entity to which this script is assigned. If no camera is assigned, the script will create one for you.",type:"entity"}),FirstPersonView.prototype.initialize=function(){var e=this.app;this.camera||(this.camera=this.entity.findByName("Camera"),this.camera||(this.camera=new pc.Entity("FPS Camera"),this.camera.addComponent("camera"))),this.x=new pc.Vec3,this.z=new pc.Vec3,this.heading=new pc.Vec3,this.magnitude=new pc.Vec2,this.azimuth=0,this.elevation=0;var t=this.camera.forward.clone();t.y=0,t.normalize(),this.azimuth=Math.atan2(-t.x,-t.z)*(180/Math.PI),(new pc.Mat4).setFromAxisAngle(pc.Vec3.UP,-this.azimuth).transformVector(this.camera.forward,t),this.elevation=Math.atan(t.y,t.z)*(180/Math.PI),this.forward=0,this.strafe=0,this.jump=!1,this.cnt=0,e.on("firstperson:forward",(function(e){this.forward=e}),this),e.on("firstperson:strafe",(function(e){this.strafe=e}),this),e.on("firstperson:look",(function(e,t){this.azimuth+=e,this.elevation+=t,this.elevation=pc.math.clamp(this.elevation,-90,90)}),this),e.on("firstperson:jump",(function(){this.jump=!0}),this)},FirstPersonView.prototype.postUpdate=function(e){this.camera.setEulerAngles(this.elevation,this.azimuth,0),this.z.copy(this.camera.forward),this.z.y=0,this.z.normalize(),this.x.copy(this.camera.right),this.x.y=0,this.x.normalize(),this.heading.set(0,0,0),0!==this.forward&&(this.z.scale(this.forward),this.heading.add(this.z)),0!==this.strafe&&(this.x.scale(this.strafe),this.heading.add(this.x)),this.heading.length()>1e-4&&(this.magnitude.set(this.forward,this.strafe),this.heading.normalize().scale(this.magnitude.length())),this.jump&&(this.entity.script.characterController.jump(),this.jump=!1),this.entity.script.characterController.move(this.heading);var t=this.camera.getPosition();this.app.fire("cameramove",t)};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){var e=this.app,updateMovement=function(t,i){switch(t){case 38:case 87:e.fire("firstperson:forward",i);break;case 40:case 83:e.fire("firstperson:forward",-i);break;case 37:case 65:e.fire("firstperson:strafe",-i);break;case 39:case 68:e.fire("firstperson:strafe",i)}},keyDown=function(t){t.repeat||(updateMovement(t.keyCode,1),32===t.keyCode&&e.fire("firstperson:jump"))},keyUp=function(e){updateMovement(e.keyCode,0)},addEventListeners=function(){window.addEventListener("keydown",keyDown,!0),window.addEventListener("keyup",keyUp,!0)};this.on("enable",addEventListeners),this.on("disable",(function(){window.addEventListener("keydown",keyDown,!0),window.addEventListener("keyup",keyUp,!0)})),addEventListeners()};var MouseInput=pc.createScript("mouseInput");function applyRadialDeadZone(e,t,i,s){var a=e.length();if(a>i){var n=1-s-i,r=Math.min(1,(a-i)/n)/a;t.copy(e).scale(r)}else t.set(0,0)}MouseInput.prototype.initialize=function(){var e=this.app,t=e.graphicsDevice.canvas,mouseDown=function(e){document.pointerLockElement!==t&&t.requestPointerLock&&t.requestPointerLock()},mouseMove=function(i){if(document.pointerLockElement===t){var s=event.movementX||event.webkitMovementX||event.mozMovementX||0,a=event.movementY||event.webkitMovementY||event.mozMovementY||0;e.fire("firstperson:look",-s/5,-a/5)}},addEventListeners=function(){window.addEventListener("mousedown",mouseDown,!1),window.addEventListener("mousemove",mouseMove,!1)};this.on("enable",addEventListeners),this.on("disable",(function(){window.removeEventListener("mousedown",mouseDown,!1),window.removeEventListener("mousemove",mouseMove,!1)})),addEventListeners()};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("deadZone",{title:"Dead Zone",description:"Radial thickness of inner dead zone of the virtual joysticks. This dead zone ensures the virtual joysticks report a value of 0 even if a touch deviates a small amount from the initial touch.",type:"number",min:0,max:.4,default:.3}),TouchInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:150}),TouchInput.attributes.add("radius",{title:"Radius",description:"The radius of the virtual joystick in CSS pixels.",type:"number",default:50}),TouchInput.attributes.add("doubleTapInterval",{title:"Double Tap Interval",description:"The time in milliseconds between two taps of the right virtual joystick for a double tap to register. A double tap will trigger a jump.",type:"number",default:300}),TouchInput.prototype.initialize=function(){var e=this.app,t=e.graphicsDevice,i=t.canvas;this.remappedPos=new pc.Vec2,this.leftStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.lastRightTap=0;var s=function(s){s.preventDefault();for(var a=t.width/i.clientWidth,n=t.height/i.clientHeight,r=s.changedTouches,o=0;o<r.length;o++){var h=r[o];if(h.pageX<=i.clientWidth/2&&-1===this.leftStick.identifier)this.leftStick.identifier=h.identifier,this.leftStick.center.set(h.pageX,h.pageY),this.leftStick.pos.set(0,0),e.fire("leftjoystick:enable",h.pageX*a,h.pageY*n);else if(h.pageX>i.clientWidth/2&&-1===this.rightStick.identifier){this.rightStick.identifier=h.identifier,this.rightStick.center.set(h.pageX,h.pageY),this.rightStick.pos.set(0,0),e.fire("rightjoystick:enable",h.pageX*a,h.pageY*n);var d=Date.now();d-this.lastRightTap<this.doubleTapInterval&&e.fire("firstperson:jump"),this.lastRightTap=d}}}.bind(this),a=function(s){s.preventDefault();for(var a=t.width/i.clientWidth,n=t.height/i.clientHeight,r=s.changedTouches,o=0;o<r.length;o++){var h=r[o];h.identifier===this.leftStick.identifier?(this.leftStick.pos.set(h.pageX,h.pageY),this.leftStick.pos.sub(this.leftStick.center),this.leftStick.pos.scale(1/this.radius),e.fire("leftjoystick:move",h.pageX*a,h.pageY*n)):h.identifier===this.rightStick.identifier&&(this.rightStick.pos.set(h.pageX,h.pageY),this.rightStick.pos.sub(this.rightStick.center),this.rightStick.pos.scale(1/this.radius),e.fire("rightjoystick:move",h.pageX*a,h.pageY*n))}}.bind(this),n=function(t){t.preventDefault();for(var i=t.changedTouches,s=0;s<i.length;s++){var a=i[s];a.identifier===this.leftStick.identifier?(this.leftStick.identifier=-1,e.fire("firstperson:forward",0),e.fire("firstperson:strafe",0),e.fire("leftjoystick:disable")):a.identifier===this.rightStick.identifier&&(this.rightStick.identifier=-1,e.fire("rightjoystick:disable"))}}.bind(this),addEventListeners=function(){i.addEventListener("touchstart",s,!1),i.addEventListener("touchmove",a,!1),i.addEventListener("touchend",n,!1)};this.on("enable",addEventListeners),this.on("disable",(function(){i.removeEventListener("touchstart",s,!1),i.removeEventListener("touchmove",a,!1),i.removeEventListener("touchend",n,!1)})),addEventListeners()},TouchInput.prototype.update=function(e){var t=this.app;if(-1!==this.leftStick.identifier){applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZone,0);var i=this.remappedPos.x;this.lastStrafe!==i&&(t.fire("firstperson:strafe",i),this.lastStrafe=i);var s=-this.remappedPos.y;this.lastForward!==s&&(t.fire("firstperson:forward",s),this.lastForward=s)}if(-1!==this.rightStick.identifier){applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZone,0);var a=-this.remappedPos.x*this.turnSpeed*e,n=-this.remappedPos.y*this.turnSpeed*e;t.fire("firstperson:look",a,n)}};var GamePadInput=pc.createScript("gamePadInput");GamePadInput.attributes.add("deadZoneLow",{title:"Low Dead Zone",description:"Radial thickness of inner dead zone of pad's joysticks. This dead zone ensures that all pads report a value of 0 for each joystick axis when untouched.",type:"number",min:0,max:.4,default:.1}),GamePadInput.attributes.add("deadZoneHigh",{title:"High Dead Zone",description:"Radial thickness of outer dead zone of pad's joysticks. This dead zone ensures that all pads can reach the -1 and 1 limits of each joystick axis.",type:"number",min:0,max:.4,default:.1}),GamePadInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:90}),GamePadInput.prototype.initialize=function(){this.app;this.lastStrafe=0,this.lastForward=0,this.lastJump=!1,this.remappedPos=new pc.Vec2,this.leftStick={center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={center:new pc.Vec2,pos:new pc.Vec2};var addEventListeners=function(){window.addEventListener("gamepadconnected",(function(e){})),window.addEventListener("gamepaddisconnected",(function(e){}))};this.on("enable",addEventListeners),this.on("disable",(function(){window.removeEventListener("gamepadconnected",(function(e){})),window.removeEventListener("gamepaddisconnected",(function(e){}))})),addEventListeners()},GamePadInput.prototype.update=function(e){for(var t=this.app,i=navigator.getGamepads?navigator.getGamepads():[],s=0;s<i.length;s++){var a=i[s];if(a&&"standard"===a.mapping&&a.axes.length>=4){this.leftStick.pos.set(a.axes[0],a.axes[1]),applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var n=this.remappedPos.x;this.lastStrafe!==n&&(t.fire("firstperson:strafe",n),this.lastStrafe=n);var r=-this.remappedPos.y;this.lastForward!==r&&(t.fire("firstperson:forward",r),this.lastForward=r),this.rightStick.pos.set(a.axes[2],a.axes[3]),applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var o=-this.remappedPos.x*this.turnSpeed*e,h=-this.remappedPos.y*this.turnSpeed*e;t.fire("firstperson:look",o,h),a.buttons[0].pressed&&!this.lastJump&&t.fire("firstperson:jump"),this.lastJump=a.buttons[0].pressed}}};var MapGen=pc.createScript("mapGen");MapGen.attributes.add("minRooms",{type:"number",default:30,min:1,max:1e3}),MapGen.attributes.add("maxRooms",{type:"number",default:50,min:1,max:1e3}),MapGen.prototype.initialize=function(){this.gen(this.minRooms,this.maxRooms)},MapGen.prototype.update=function(o){},MapGen.prototype.gen=function(o,e){this.graph=createGraph(),this.remove(),this.grid={},this.createRoom("F",new pc.Vec3);for(let o=0;o<e&&(this.check(),!(Object.keys(this.grid).length>=e));o++);Object.keys(this.grid)<o?this.gen(this.minRooms,this.maxRooms):(this.blockedDoorsGen(),setTimeout((()=>{this.app.fire("pathFinder:useGraph",this.graph)}),250))},MapGen.prototype.remove=function(){for(const o of this.entity.children)o.destroy()},MapGen.prototype.blockedDoorsGen=function(){for(const o of Object.values(this.grid)){const e=this.getVectors(o);for(const t of e){const e=o.getPosition().clone().divScalar(8);e.x=this.floorToZero(e.x),e.z=this.floorToZero(e.z),e.add(t);const n=this.occupied(e.x,e.z),i=this.getKeyForVectors(t);if(n){const e=t.clone().mulScalar(-1),c=this.getKeyForVectors(e);n.name.includes(c)||this.createBlockedDoor("Blocked Door "+i,o.getPosition())}else this.createBlockedDoor("Blocked Door "+i,o.getPosition())}}},MapGen.prototype.createBlockedDoor=function(o,e){const t=this.app.root.findByName("Cells").findByName(o).clone();t.setPosition(e),this.entity.addChild(t)},MapGen.prototype.check=function(){for(const o of Object.values(this.grid))if(!o.checked){o.checked=!0;const e=this.getVectors(o);for(const t of e){const e=o.getPosition().clone().divScalar(8);if(e.x=this.floorToZero(e.x),e.z=this.floorToZero(e.z),e.add(t),this.occupied(e.x,e.z))continue;const n=this.createRoom(this.getNeededRoom(o,t).name,e);n.connectedTo.push(o),o.connectedTo.push(n),newRoomPos=e.clone(),e.sub(t),this.graph.addLink(e.x+" "+e.z,newRoomPos.x+" "+newRoomPos.z)}}},MapGen.prototype.createRoom=function(o,e){const t={x:8*e.x,y:0,z:8*e.z},n=this.app.root.findByName("Cells").findByName(o).clone();return n.setPosition(t.x,t.y,t.z),n.checked=!1,n.connectedTo=[],this.entity.addChild(n),this.grid[e.x+" "+e.z]=n,this.graph.addNode(e.x+" "+e.z,{entity:n,position:n.getPosition()}),n},MapGen.prototype.floorToZero=function(o){return o>0?Math.floor(o):-Math.floor(-o)},MapGen.prototype.find=function(o){return this.app.root.findByName("Cells").findByName(o)},MapGen.prototype.getVectors=function(o){const e={F:new pc.Vec3(0,0,-1),B:new pc.Vec3(0,0,1),L:new pc.Vec3(-1,0,0),R:new pc.Vec3(1,0,0)},t=[];for(const n of o.name)t.push(e[n]);return t},MapGen.prototype.getNeededRoom=function(o,e){const t=e.clone().mulScalar(-1),n=this.getKeyForVectors(t);return this.getRandomRoom(n)},MapGen.prototype.getRandomRoom=function(o){const e=[];for(const t of this.app.root.findByName("Rooms").children)t.name.includes(o)&&e.push(t);return e[Math.floor(Math.random()*e.length)]},MapGen.prototype.getKeyForVectors=function(o){const e={F:new pc.Vec3(0,0,-1),B:new pc.Vec3(0,0,1),L:new pc.Vec3(-1,0,0),R:new pc.Vec3(1,0,0)};for(const t in e)if(e[t].equals(o))return t},MapGen.prototype.occupied=function(o,e){return!!this.grid[o+" "+e]&&this.grid[o+" "+e]};var MonstaAi=pc.createScript("monstaAi");MonstaAi.attributes.add("camera",{type:"entity"}),MonstaAi.prototype.initialize=function(){this.app.on("MonstaAi:getPathFinder",this.getPathFinder,this),this.oldSPos=new pc.Vec3,this.oldSPlayerPos=new pc.Vec3,this.tmp=new pc.Vec3},MonstaAi.prototype.update=function(t){const o=this.simplifyPos(this.entity.getPosition()),i=this.simplifyPos(this.camera.getPosition());o.equals(this.oldSPos)&&i.equals(this.oldSPlayerPos)||(this.oldSPos=o,this.oldSPlayerPos=i,this.pathFinder&&(this.path=this.pathFinder.find(o.x+" "+o.z,i.x+" "+i.z)))},MonstaAi.prototype.simplifyPos=function(t){return t=t.clone().set(this.floorToZero((t.x-4)/8),0,this.floorToZero((t.z-4)/8))},MonstaAi.prototype.floorToZero=function(t){return t>0?Math.floor(t):-Math.floor(-t)},MonstaAi.prototype.getPathFinder=function(t){this.pathFinder=t};